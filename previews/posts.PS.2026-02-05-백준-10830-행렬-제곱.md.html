
      <html lang="ko">
      <head>
        <title>10830 - í–‰ë ¬ ì œê³±</title>
        <link rel="canonical" href="http://yuyeol3.github.io/"/>
        <meta charset="utf-8"/>
        <meta name="description" content="ì´ ë¬¸ì œëŠ” í¬ê¸°ê°€ $N \times N$ì¸ í–‰ë ¬ì´ ì£¼ì–´ì§ˆ ë•Œ, ê·¸ í–‰ë ¬ì˜ $B$ì œê³±ì„ êµ¬í•´ì„œ ì¶œë ¥í•´ì•¼ í•˜ëŠ” ë¬¸ì œì´ë‹¤. ì´ ë¶€ë¶„ì—ì„œ íŠ¹íˆ ëˆˆì—¬ê²¨ë´ì•¼ í•  ê²ƒì€ $B$ì˜ ìµœëŒ€ê°’ì´ë‹¤. $B$ëŠ” ì´ ë¬¸ì œì—ì„œ ìµœëŒ€ 1ì²œì–µê¹Œì§€ ë  ìˆ˜ ìˆìœ¼ë©° ë”°ë¼ì„œ í–‰ë ¬ì„ ë‹¨ìˆœíˆ $B$ë²ˆ ê³±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê±°ë“­ì œê³±ì„ êµ¬í•˜ë©´ ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ ë¬¸ì œë¥¼ í’€ì§€ ëª»í•  ê²ƒì´ë‹¤.">
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
      </head>
      <body style="display : none;">
        
        <h1>10830 - í–‰ë ¬ ì œê³±</h1>
<p>ì´ ë¬¸ì œëŠ” í¬ê¸°ê°€ $N \times N$ì¸ í–‰ë ¬ì´ ì£¼ì–´ì§ˆ ë•Œ, ê·¸ í–‰ë ¬ì˜ $B$ì œê³±ì„ êµ¬í•´ì„œ ì¶œë ¥í•´ì•¼ í•˜ëŠ” ë¬¸ì œì´ë‹¤. ì´ ë¶€ë¶„ì—ì„œ íŠ¹íˆ ëˆˆì—¬ê²¨ë´ì•¼ í•  ê²ƒì€ $B$ì˜ ìµœëŒ€ê°’ì´ë‹¤. $B$ëŠ” ì´ ë¬¸ì œì—ì„œ ìµœëŒ€ 1ì²œì–µê¹Œì§€ ë  ìˆ˜ ìˆìœ¼ë©° ë”°ë¼ì„œ í–‰ë ¬ì„ ë‹¨ìˆœíˆ $B$ë²ˆ ê³±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê±°ë“­ì œê³±ì„ êµ¬í•˜ë©´ ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ ë¬¸ì œë¥¼ í’€ì§€ ëª»í•  ê²ƒì´ë‹¤.</p>
<p>ê·¸ë ‡ë‹¤ë©´ ì´ ë¬¸ì œë¥¼ ì‹œê°„ ë‚´ì— í’€ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? ì–´ë–¤ í–‰ë ¬ $\mathbf{A}$ê°€ ìˆì„ ë•Œ $\mathbf A^{16}$ì„ êµ¬í•´ì•¼ í•œë‹¤ê³  ìƒê°í•´ë³´ì. ê·¸ë ‡ë‹¤ë©´ $\mathbf A^{16} = \mathbf A^{8} \cdot \mathbf A^8$ ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ë¶„ë¦¬í•´ì„œ ê³„ì‚°í•˜ë©´ ì–´ë–¤ ì ì´ ì¢‹ì„ê¹Œ? $\mathbf A^{16}$ì„ ê³„ì‚°í•˜ëŠ” ëŒ€ì‹ , $\mathbf A^8$ì„ í•œ ë²ˆ ê³„ì‚°í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ì œê³±í•˜ë©´ $\mathbf A^{16}$ì„ ì–»ì„ ìˆ˜ ìˆë‹¤. ì¦‰ ê³„ì‚° íšŸìˆ˜ê°€ 16ë²ˆì´ ì•„ë‹ˆë¼ 9ë²ˆìœ¼ë¡œ ì¤„ì–´ë“ ë‹¤! ë˜í•œ $\mathbf A^{16} = \mathbf A^8 \cdot \mathbf A^8$ ë¡œ ë¶„ë¦¬í–ˆë˜ ê²ƒì²˜ëŸ¼, $\mathbf A^8 = \mathbf A^4 \cdot \mathbf A^4$ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ê³„ì† ë¶„ë¦¬í•˜ë©´ $\mathbf A^2 = \mathbf A \cdot \mathbf A$ì²˜ëŸ¼ ëê¹Œì§€ ë¶„ë¦¬ì‹œí‚¬ ìˆ˜ ìˆë‹¤. ì¦‰, ì¬ê·€ì ìœ¼ë¡œ í–‰ë ¬ê³± ê³„ì‚° íšŸìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ì¤„ì–´ë“  í–‰ë ¬ê³± ê³„ì‚° íšŸìˆ˜ëŠ” $\log_2 B$ ì— ë¹„ë¡€í•˜ê²Œ ëœë‹¤.</p>
<p>ì¡°ê¸ˆ ë” ìì„¸íˆ í‘œí˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤</p>
<p>$$\mathbf A^N = \begin{cases}
    (\mathbf A^{N/2})^2 &amp; \text{if N is even} \
    \mathbf A \cdot \mathbf A^{N-1} &amp; \text{if N is odd}
\end{cases}
$$</p>
<p>ì¦‰, ì§ìˆ˜ì¼ ê²½ìš° ì§€ìˆ˜ë¥¼ ì ˆë°˜ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ë˜ê³ , í™€ìˆ˜ì¼ ê²½ìš° ì§ìˆ˜ ì§€ìˆ˜ë¡œ ë§Œë“¤ì–´ì£¼ê¸° ìœ„í•´ ê³± í•˜ë‚˜ë¥¼ ë–¼ì–´ë‚´ë©´ ëœë‹¤. ì´ ì‹ì— ë”°ë¼ ì¬ê·€ì ìœ¼ë¡œ í–‰ë ¬ ê±°ë“­ì œê³±ì„ ë¶„ë¦¬í•´ ì§€ìˆ˜ê°€ 1ì´ ë  ë•Œê¹Œì§€ ë°˜ë³µí•˜ë©´ ëœë‹¤. </p>
<p><a href="https://www.acmicpc.net/problem/10830">ğŸ”— ë¬¸ì œ ë§í¬</a></p>
<h2>ì½”ë“œ</h2>
<p>í–‰ë ¬ ì›ì†Œë¥¼ ì €ì¥í•  ë³€ìˆ˜ <code>mat</code>ë¥¼ ì„ ì–¸í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë©”ì¸ ë©”ì„œë“œì—ì„œ í–‰ë ¬ì˜ í¬ê¸° <code>N</code>ê³¼ ê±°ë“­ì œê³±ì˜ ìˆ˜ <code>B</code>ë¥¼ ì…ë ¥ë°›ê³ , í–‰ë ¬ì˜ í¬ê¸°ì— ë”°ë¼ <code>mat</code> ë°°ì—´ì„ ë©”ëª¨ë¦¬ì— í• ë‹¹í•œë‹¤.</p>
<pre><code class="language-java">static int[][] mat;
public static void main(String[] args) throws IOException {
    StringTokenizer st = new StringTokenizer(br.readLine());
    int N;
    long B;

    N = Integer.parseInt(st.nextToken());
    B = Long.parseLong(st.nextToken());

    mat = new int[N][N];
</code></pre>
<p>ì´ì œ í–‰ë ¬ì˜ ì›ì†Œë“¤ì„ ì…ë ¥ë°›ëŠ”ë‹¤. ì…ë ¥ë°›ì€ ìˆ˜ì— <code>% 1000</code>ìœ¼ë¡œ ëª¨ë“ˆëŸ¬ ì—°ì‚°ì„ í•˜ëŠ” ì´ìœ ëŠ” <code>B</code>ê°€ 1ì´ì–´ì„œ ê±°ë“­ì œê³±ì„ í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë„ ë¬¸ì œì˜ ìš”êµ¬ì— ë”°ë¼ ëª¨ë“ˆëŸ¬ ì—°ì‚°ì„ í•œ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œì´ë‹¤.</p>
<pre><code class="language-java">    for (int i = 0; i &lt; N; i++) {
        st = new StringTokenizer(br.readLine());
        for (int j = 0; j &lt; N; j++) {
            mat[i][j] = Integer.parseInt(st.nextToken()) % 1000;
        }
    }
</code></pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ìœ„ì—ì„œ ì‚´í´ë³¸ ì›ë¦¬ì— ë”°ë¼ ë§Œë“  ì¬ê·€í•¨ìˆ˜ <code>matPow(B)</code>ë¥¼ í˜¸ì¶œí•´ í–‰ë ¬ <code>mat</code>ì— ëŒ€í•œ <code>B</code> ê±°ë“­ì œê³±ì˜ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ <code>res</code>ì— ì €ì¥í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê·¸ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ê³  í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•œë‹¤.</p>
<pre><code class="language-java">    int[][] res = matPow(B);
    StringBuilder sb = new StringBuilder();

    for (int i = 0; i &lt; N; i++) {
        for (int j = 0; j &lt; N; j++) {
            sb.append(res[i][j]).append(&quot; &quot;);
        }
        sb.append(&quot;\n&quot;);
    }
    System.out.print(sb);
}
</code></pre>
<p>í–‰ë ¬ ê±°ë“­ì œê³±ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì•ì„œì„œ ì–¸ê¸‰í–ˆë“¯ ì§ìˆ˜ì¼ ê²½ìš°ì™€ í™€ìˆ˜ì¼ ê²½ìš°ì— ë”°ë¼ ì§€ìˆ˜ë¥¼ ì²˜ë¦¬í•œ ë’¤ <code>matPow</code>í•¨ìˆ˜ë¥¼ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œí•´ ê²°ê³¼ë¥¼ ë°˜í™˜ë°›ì€ ë‹¤ìŒ ë¯¸ë¦¬ êµ¬í˜„í•´ë‘” í–‰ë ¬ê³± í•¨ìˆ˜ <code>matMul</code>ì„ ì´ìš©í•´ ìµœì¢… ê²°ê³¼ë¥¼ ê³„ì‚°í•œë‹¤. ê¸°ì € ì¡°ê±´ì€ <code>n==1</code>ë¡œ íŠ¹ë³„í•œ ì²˜ë¦¬ ì—†ì´ ì…ë ¥ë°›ì€ <code>mat</code> í–‰ë ¬ì„ ë°˜í™˜í•œë‹¤.</p>
<p>ì—¬ê¸°ì„œ ëˆˆì—¬ê²¨ë´ì•¼ í•  ì ì€ <code>return matMul(matPow(n/2), matPow(n/2))</code> ê°€ ì•„ë‹ˆë¼ <code>half = matPow(n/2)</code>ë¡œ ê³„ì‚°í•œ ë‹¤ìŒ <code>matMul</code>ì„ ì´ìš©í•´ <code>half</code>ë¥¼ ì œê³±í•œë‹¤ëŠ” ì ì´ë‹¤. ê³„ì‚°ëŸ‰ì„ ì¤„ì´ê¸° ìœ„í•´ì„œëŠ” ì§€ìˆ˜ë¥¼ ë¶„ë¦¬í•œ ë‹¤ìŒ ì¬ê·€í•¨ìˆ˜ë¥¼ ë‘ ë²ˆ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•œ ë²ˆë§Œ í˜¸ì¶œí•˜ê³  ê·¸ ê°’ì„ ì´ìš©í•´ ì›ë˜ êµ¬í•˜ê³ ì í•˜ëŠ” ê°’ì„ ê³„ì‚°í•´ì•¼ í•œë‹¤. ë‘ ë²ˆ í˜¸ì¶œí•  ê²½ìš° ê²°êµ­ í–‰ë ¬ì„ Në²ˆ ê³±í•˜ëŠ” ê²ƒê³¼ ê°™ì•„ì§€ë‹ˆ ì´ ì ì„ ìœ ì˜í•´ì•¼ í•œë‹¤.</p>
<pre><code class="language-java">static int[][] matPow(long n) {
    if (n == 1)
        return mat;
    
    if (n % 2 == 0) {
        int[][] half = matPow(n / 2);
        return matMul(half, half);
    }

    return matMul(mat, matPow(n-1));
}
</code></pre>
<p>í–‰ë ¬ê³±ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ë‘ í–‰ë ¬ì„ ë°›ì€ ë‹¤ìŒ í–‰ë ¬ì˜ $(i,j)$ ì›ì†Œì— ëŒ€í•´ $\sum_{k=0}^{N} A_{ik} \cdot B_{kj}$ ìœ¼ë¡œ í–‰ë ¬ê³±ì˜ ê²°ê³¼ë¥¼ ê³„ì‚°í•œë‹¤.</p>
<pre><code class="language-java">static int[][] matMul(final int[][] a, final int[][] b) {
    int n = a.length;
    int[][] result = new int[n][n];
    for (int i = 0; i &lt; n; i++) {
        for (int j = 0; j &lt; n; j++) {
            for (int k = 0; k &lt; n; k++)
                result[i][j] = (result[i][j] + a[i][k] * b[k][j]) % 1000;
        }
    }

    return result;
}
</code></pre>
<h2>ì „ì²´ ì½”ë“œ</h2>
<pre><code class="language-java">import java.util.*;
import java.io.*;

class Main {
    static BufferedReader br = new BufferedReader(new InputStreamReader(System.in));

    static int[][] mat;
    public static void main(String[] args) throws IOException {
        StringTokenizer st = new StringTokenizer(br.readLine());
        int N;
        long B;

        N = Integer.parseInt(st.nextToken());
        B = Long.parseLong(st.nextToken());

        mat = new int[N][N];

        for (int i = 0; i &lt; N; i++) {
            st = new StringTokenizer(br.readLine());
            for (int j = 0; j &lt; N; j++) {
                mat[i][j] = Integer.parseInt(st.nextToken()) % 1000;
            }
        }

        int[][] res = matPow(B);
        StringBuilder sb = new StringBuilder();

        for (int i = 0; i &lt; N; i++) {
            for (int j = 0; j &lt; N; j++) {
                sb.append(res[i][j]).append(&quot; &quot;);
            }
            sb.append(&quot;\n&quot;);
        }
        System.out.print(sb);
    }

    static int[][] matMul(final int[][] a, final int[][] b) {
        int n = a.length;
        int[][] result = new int[n][n];
        for (int i = 0; i &lt; n; i++) {
            for (int j = 0; j &lt; n; j++) {
                for (int k = 0; k &lt; n; k++)
                    result[i][j] = (result[i][j] + a[i][k] * b[k][j]) % 1000;
            }
        }

        return result;
    }

    static int[][] matPow(long n) {
        if (n == 1)
            return mat;
        
        if (n % 2 == 0) {
            int[][] half = matPow(n / 2);
            return matMul(half, half);
        }

        return matMul(mat, matPow(n-1));
    }
}
</code></pre>
<h2>ì‹œê°„ë³µì¡ë„</h2>
<p>ì•ì„œ ë§í–ˆë“¯ ë¶„í•  ì •ë³µ ë°©ì‹ìœ¼ë¡œ í–‰ë ¬ì˜ ê±°ë“­ì œê³±ì„ êµ¬í•˜ë©´, í–‰ë ¬ê³±ì„ í•´ì•¼ í•˜ëŠ” íšŸìˆ˜ëŠ” $O(\log B)$ ì— ë¹„ë¡€í•˜ê²Œ ë˜ê³ , í–‰ë ¬ê³± ìì²´ì˜ ì‹œê°„ë³µì¡ë„ëŠ” $O(N^3)$ê°€ ëœë‹¤. ë”°ë¼ì„œ ì´ ì½”ë“œì˜ ì‹œê°„ë³µì¡ë„ëŠ” $O(N^3 \log B)$ê°€ ëœë‹¤. </p>
<p>$N \le 5$, $B \le 100,000,000,000$ ì´ë¯€ë¡œ ìµœì•…ì˜ ê²½ìš°ì—ë„ $5 \log_2 100,000,000,000 \approx 125 \times 33 = 4125 $ íšŒë¡œ ì œí•œì‹œê°„ ë‚´ì— ì¶©ë¶„íˆ í†µê³¼í•  ìˆ˜ ìˆë‹¤.</p>

        <script>
          location.href = "/post-view?href=posts%2FPS%2F2026-02-05-%EB%B0%B1%EC%A4%80-10830-%ED%96%89%EB%A0%AC-%EC%A0%9C%EA%B3%B1.md"
        </script>
      </body>
  